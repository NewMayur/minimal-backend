# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on merge
on:
  push:
    branches:
      - develop

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Deploy to Firebase
        uses: actions/exec@v1
        with:
          working-directory: ./
          command: |
            #!/bin/bash
            # Check for environment argument
            if [ -z "$1" ]; then
              echo "Usage: ./deploy.sh [dev|stag|prod]"
              exit 1
            fi

            # Set the appropriate site and config file based on the environment
            if [ "$1" == "dev" ]; then
              site="minimal-app-dev"
              CONFIG_FILE="firebase.dev.json"
            elif [ "$1" == "stag" ]; then
              site="minimal-app-stag"
              CONFIG_FILE="firebase.stag.json"
            elif [ "$1" == "prod" ]; then
              site="minimal-app-prod"
              CONFIG_FILE="firebase.prod.json"
            else
              echo "Invalid environment. Use dev, stag, or prod."
              exit 1
            fi

            # Copy the environment-specific config to firebase.json
            cp $CONFIG_FILE firebase.json

            # Deploy to Firebase hosting site
            firebase deploy --only hosting:$site
        env:
          # Pass the environment as an argument to your script
          ENV: ${{ github.event.ref.replace('refs/heads/', '') }} 
